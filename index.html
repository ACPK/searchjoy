<!DOCTYPE html>
<html>
  <head>
    <title>Searchjoy - Search Analytics Made Easy</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="github.css">
    <style>
      body {
        padding-bottom: 20px;
      }

      .container {
        max-width: 800px;
      }

      h2, h3, h4 {
        margin-top: 1em;
      }

      p {
        margin-top: 1.5em;
        margin-bottom: 1.5em;
      }

      p.lead {
        margin-top: 0;
      }
    </style>

    <meta property="og:title" content="Searchjoy"/>
    <meta property="og:url" content="http://ankane.github.io/searchjoy/"/>
    <meta property="og:image" content="https://github.global.ssl.fastly.net/images/gravatars/gravatar-user-420.png"/>
    <meta property="og:description" content="Search analytics made easy"/>

  </head>
  <body>
    <a href="https://github.com/ankane/searchjoy" style="position: fixed; top: 15px; right: 15px; border: 0; z-index: 1000;" class="btn btn-info">Github</a>

    <div class="container">
      <div class="row">
        <div class="col-sm-12">
          <h1 style="margin-bottom: 0.5em; margin-top: 15px;">Searchjoy</h1>
        </div>
      </div>
      <div class="row">
        <div class="col-sm-6">
          <p class="lead"><img class="emoji" title=":monkey_face:" alt=":monkey_face:" src="https://github.global.ssl.fastly.net/images/icons/emoji/monkey_face.png" height="20" width="20" align="absmiddle"> Search analytics made easy</p>
        </div>
        <div class="col-sm-6">
          <p class="lead"><img class="emoji" title=":tangerine:" alt=":tangerine:" src="https://github.global.ssl.fastly.net/images/icons/emoji/tangerine.png" height="20" width="20" align="absmiddle"> Battle-tested at <a href="https://www.instacart.com">Instacart</a></p>
        </div>
      </div>
      <div class="row">
        <div class="col-sm-12">
          <hr style="margin-top: 0;" />

<!-- begin readme -->

<ul>
<li>view searches in real-time</li>
<li>track conversions week over week</li>
<li>monitor the performance of top searches</li>
</ul>

<p><a href="http://searchjoy.herokuapp.com/" class="btn btn-success btn-lg">See it in action</a></p>

<p>Works with Rails 3.1+ and any search engine, including Elasticsearch, Sphinx, and Solr</p>

<p><img class="emoji" title=":cupid:" alt=":cupid:" src="https://github.global.ssl.fastly.net/images/icons/emoji/cupid.png" height="20" width="20" align="absmiddle"> An amazing companion to <a href="https://github.com/ankane/searchkick">Searchkick</a></p>

<h2>
<a name="get-started" class="anchor" href="#get-started"><span class="octicon octicon-link"></span></a>Get Started</h2>

<p>Add this line to your application’s Gemfile:</p>

<div class="highlight highlight-ruby"><pre><span class="n">gem</span> <span class="s2">"searchjoy"</span>
</pre></div>

<p>And run the generator. This creates a migration to store searches.</p>

<div class="highlight highlight-sh"><pre>rails generate searchjoy:install
rake db:migrate
</pre></div>

<p>Next, add the dashboard to your <code>config/routes.rb</code>.</p>

<div class="highlight highlight-ruby"><pre><span class="n">mount</span> <span class="ss">Searchjoy</span><span class="p">:</span><span class="ss">:Engine</span><span class="p">,</span> <span class="ss">at</span><span class="p">:</span> <span class="s2">"admin/searchjoy"</span>
</pre></div>

<p>Be sure to protect the endpoint in production - see the <a href="#authentication">Authentication</a> section for ways to do this.</p>

<h3>
<a name="track-searches" class="anchor" href="#track-searches"><span class="octicon octicon-link"></span></a>Track Searches</h3>

<p>Track searches by creating a record in the database.</p>

<div class="highlight highlight-ruby"><pre><span class="ss">Searchjoy</span><span class="p">:</span><span class="ss">:Search</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
  <span class="n">search_type</span><span class="p">:</span> <span class="s2">"Item"</span><span class="p">,</span> <span class="c1"># typically the model name</span>
  <span class="ss">query</span><span class="p">:</span> <span class="s2">"apple"</span><span class="p">,</span>
  <span class="n">results_count</span><span class="p">:</span> <span class="mi">12</span>
<span class="p">)</span>
</pre></div>

<p>With <a href="https://github.com/ankane/searchkick">Searchkick</a>, you can use the <code>track</code> option to do this automatically.</p>

<div class="highlight highlight-ruby"><pre><span class="no">Item</span><span class="o">.</span><span class="n">search</span> <span class="s2">"apple"</span><span class="p">,</span> <span class="ss">track</span><span class="p">:</span> <span class="kp">true</span>
</pre></div>

<p>If you want to track more attributes, add them to the <code>searchjoy_searches</code> table.  Then, pass the values to the <code>track</code> option.</p>

<div class="highlight highlight-ruby"><pre><span class="no">Item</span><span class="o">.</span><span class="n">search</span> <span class="s2">"apple"</span><span class="p">,</span> <span class="ss">track</span><span class="p">:</span> <span class="p">{</span><span class="n">user_id</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">source</span><span class="p">:</span> <span class="s2">"web"</span><span class="p">}</span>
</pre></div>

<p>It’s that easy.</p>

<h3>
<a name="track-conversions" class="anchor" href="#track-conversions"><span class="octicon octicon-link"></span></a>Track Conversions</h3>

<p>First, choose a conversion metric. At Instacart, an item added to the cart from the search results page counts as a conversion.</p>

<p>Next, when a user searches, keep track of the search id. With Searchkick, you can get the id with <code>@results.search.id</code>.</p>

<p>When a user converts, find the record and call <code>convert</code>.</p>

<div class="highlight highlight-ruby"><pre><span class="n">search</span> <span class="o">=</span> <span class="ss">Searchjoy</span><span class="p">:</span><span class="ss">:Search</span><span class="o">.</span><span class="n">find</span> <span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span>
<span class="n">search</span><span class="o">.</span><span class="n">convert</span>
</pre></div>

<p>Better yet, record the model that converted.</p>

<div class="highlight highlight-ruby"><pre><span class="n">item</span> <span class="o">=</span> <span class="no">Item</span><span class="o">.</span><span class="n">find</span> <span class="n">params</span><span class="o">[</span><span class="ss">:item_id</span><span class="o">]</span>
<span class="n">search</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</pre></div>

<h3>
<a name="authentication" class="anchor" href="#authentication"><span class="octicon octicon-link"></span></a>Authentication</h3>

<p>Don’t forget to protect the dashboard in production.</p>

<h4>
<a name="basic-authentication" class="anchor" href="#basic-authentication"><span class="octicon octicon-link"></span></a>Basic Authentication</h4>

<p>Set the following variables in your environment or an initializer.</p>

<div class="highlight highlight-ruby"><pre><span class="no">ENV</span><span class="o">[</span><span class="s2">"SEARCHJOY_USERNAME"</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"andrew"</span>
<span class="no">ENV</span><span class="o">[</span><span class="s2">"SEARCHJOY_PASSWORD"</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"secret"</span>
</pre></div>

<h4>
<a name="devise" class="anchor" href="#devise"><span class="octicon octicon-link"></span></a>Devise</h4>

<div class="highlight highlight-ruby"><pre><span class="n">authenticate</span> <span class="ss">:user</span><span class="p">,</span> <span class="nb">lambda</span><span class="p">{</span><span class="o">|</span><span class="n">user</span><span class="o">|</span> <span class="n">user</span><span class="o">.</span><span class="n">admin?</span> <span class="p">}</span> <span class="k">do</span>
  <span class="n">mount</span> <span class="ss">Searchjoy</span><span class="p">:</span><span class="ss">:Engine</span><span class="p">,</span> <span class="ss">at</span><span class="p">:</span> <span class="s2">"admin/searchjoy"</span>
<span class="k">end</span>
</pre></div>

<h3>
<a name="customize" class="anchor" href="#customize"><span class="octicon octicon-link"></span></a>Customize</h3>

<h4>
<a name="time-zone" class="anchor" href="#time-zone"><span class="octicon octicon-link"></span></a>Time Zone</h4>

<p>To change the time zone, create an initializer <code>config/initializers/searchjoy.rb</code> with:</p>

<div class="highlight highlight-ruby"><pre><span class="no">Searchjoy</span><span class="o">.</span><span class="n">time_zone</span> <span class="o">=</span> <span class="s2">"Pacific Time (US &amp; Canada)"</span> <span class="c1"># defaults to Time.zone</span>
</pre></div>

<h4>
<a name="top-searches" class="anchor" href="#top-searches"><span class="octicon octicon-link"></span></a>Top Searches</h4>

<p>Change the number of top searches shown with:</p>

<div class="highlight highlight-ruby"><pre><span class="no">Searchjoy</span><span class="o">.</span><span class="n">top_searches</span> <span class="o">=</span> <span class="mi">500</span> <span class="c1"># defaults to 100</span>
</pre></div>

<h4>
<a name="live-conversions" class="anchor" href="#live-conversions"><span class="octicon octicon-link"></span></a>Live Conversions</h4>

<p>Show the conversion name in the live stream.</p>

<div class="highlight highlight-ruby"><pre><span class="no">Searchjoy</span><span class="o">.</span><span class="n">conversion_name</span> <span class="o">=</span> <span class="nb">proc</span><span class="p">{</span><span class="o">|</span><span class="n">model</span><span class="o">|</span> <span class="n">model</span><span class="o">.</span><span class="n">name</span> <span class="p">}</span>
</pre></div>

<h2>
<a name="todo" class="anchor" href="#todo"><span class="octicon octicon-link"></span></a>TODO</h2>

<ul>
<li>customize views</li>
<li>group similar queries</li>
<li>track pagination, facets, sorting, etc</li>
</ul><h2>
<a name="contributing" class="anchor" href="#contributing"><span class="octicon octicon-link"></span></a>Contributing</h2>

<p>Everyone is encouraged to help improve this project. Here are a few ways you can help:</p>

<ul>
<li><a href="https://github.com/ankane/searchjoy/issues">Report bugs</a></li>
<li>Fix bugs and <a href="https://github.com/ankane/searchjoy/pulls">submit pull requests</a>
</li>
<li>Write, clarify, or fix documentation</li>
<li>Suggest or add new feature</li>
</ul>

<!-- end readme -->

        </div>
      </div>
    </div>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-39027070-7', 'ankane.github.io');
      ga('send', 'pageview');
    </script>
  </body>
</html>
